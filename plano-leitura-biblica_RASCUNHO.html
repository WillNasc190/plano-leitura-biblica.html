<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plano Anual de Leitura Bíblica</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 1200px;
            min-height: 80vh;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .admin-controls {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 10px;
        }

        .admin-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .admin-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .back-button {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
        }

        .back-button:hover {
            background: rgba(255,255,255,0.3);
        }

        .content {
            padding: 30px;
            min-height: 500px;
        }

        .hidden {
            display: none;
        }

        /* Login Modal */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-form {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            min-width: 350px;
            text-align: center;
        }

        .login-input {
            width: 100%;
            padding: 12px 20px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
        }

        .login-input:focus {
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }

        .login-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 15px;
        }

        .login-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        /* Cards dos dias */
        .day-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .day-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
            min-height: 120px;
        }

        .day-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .day-card:hover::before {
            left: 100%;
        }

        .day-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        /* Capítulos */
        .chapter-grid {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .chapter-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            border-left: 5px solid #3498db;
        }

        .chapter-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chapter-title::before {
            content: "📖";
            margin-right: 10px;
        }

        .edit-menu-btn {
            background: #f39c12;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
        }

        .study-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .study-button {
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 500;
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .pregacao { background: linear-gradient(135deg, #ff6b6b, #ee5a24); }
        .estudo { background: linear-gradient(135deg, #4834d4, #686de0); }
        .controversos { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .oracao { background: linear-gradient(135deg, #8e44ad, #9b59b6); }
        .prayer { background: linear-gradient(135deg, #16a085, #1abc9c); }
        .custom { background: linear-gradient(135deg, #95a5a6, #7f8c8d); }

        .study-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Editor de Texto */
        .text-editor {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .editor-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .editor-title {
            font-size: 1.3em;
            font-weight: bold;
        }

        .editor-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.25);
        }

        .control-btn.active {
            background: #27ae60;
            border-color: #27ae60;
        }

        .editor-textarea {
            width: 100%;
            min-height: 500px;
            padding: 30px;
            border: none;
            outline: none;
            font-size: 16px;
            line-height: 1.8;
            font-family: 'Georgia', 'Times New Roman', serif;
            text-align: justify;
            resize: vertical;
            background: #fefefe;
            transition: all 0.3s ease;
        }

        .editor-textarea:focus {
            background: white;
            box-shadow: inset 0 2px 8px rgba(52, 152, 219, 0.1);
        }

        /* Modo Visualização */
        .reading-mode {
            width: 100%;
            min-height: 600px;
            padding: 40px 50px;
            border: none;
            outline: none;
            font-size: 20px;
            line-height: 2;
            font-family: 'Georgia', 'Times New Roman', serif;
            text-align: justify;
            background: #fefefe;
            color: #2c3e50;
            cursor: text;
            border-radius: 0 0 15px 15px;
        }

        .reading-mode:focus {
            background: #fcfcfc;
            box-shadow: inset 0 2px 15px rgba(52, 152, 219, 0.1);
        }

        .editor-footer {
            padding: 20px 30px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .word-stats {
            display: flex;
            gap: 20px;
            color: #7f8c8d;
            font-size: 14px;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #eee;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }

        .export-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @media (max-width: 768px) {
            .content { padding: 15px; }
            .admin-controls {
                position: relative;
                right: 0; top: 0;
                transform: none;
                margin-top: 15px;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="back-button" onclick="voltarIndice()">← Voltar ao Índice</button>
            <div class="admin-controls">
                <button class="admin-btn" onclick="mostrarLogin()" id="admin-login-btn">🔐 Admin</button>
                <button class="admin-btn hidden" onclick="logout()" id="admin-logout-btn">🚪 Sair</button>
            </div>
            <h1 id="page-title">📖 Plano Anual de Leitura Bíblica</h1>
            <p>365 Dias | Gênesis ao Apocalipse | Almeida Atualizada</p>
        </div>

        <div class="content">
            <!-- Página Índice -->
            <div id="indice-page">
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filtrarPorMes('todos')">Calendário de Estudo</button>
                    <button class="filter-btn" onclick="filtrarPorMes('jan')">Janeiro</button>
                    <button class="filter-btn" onclick="filtrarPorMes('fev')">Fevereiro</button>
                    <button class="filter-btn" onclick="filtrarPorMes('mar')">Março</button>
                    <button class="filter-btn" onclick="filtrarPorMes('abr')">Abril</button>
                    <button class="filter-btn" onclick="filtrarPorMes('mai')">Maio</button>
                    <button class="filter-btn" onclick="filtrarPorMes('jun')">Junho</button>
                    <button class="filter-btn" onclick="filtrarPorMes('jul')">Julho</button>
                    <button class="filter-btn" onclick="filtrarPorMes('ago')">Agosto</button>
                    <button class="filter-btn" onclick="filtrarPorMes('set')">Setembro</button>
                    <button class="filter-btn" onclick="filtrarPorMes('out')">Outubro</button>
                    <button class="filter-btn" onclick="filtrarPorMes('nov')">Novembro</button>
                    <button class="filter-btn" onclick="filtrarPorMes('dez')">Dezembro</button>
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number">365</div>
                        <div>Dias</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">1,189</div>
                        <div>Capítulos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">31,102</div>
                        <div>Versículos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">66</div>
                        <div>Livros</div>
                    </div>
                </div>

                <div class="day-grid" id="day-grid">
                    <!-- Os dias serão gerados dinamicamente -->
                </div>

                <div class="export-buttons">
                    <button class="export-btn" onclick="exportarParaExcel()">📊 Exportar para Excel</button>
                    <button class="export-btn" onclick="exportarMarkdown()">📝 Exportar Markdown</button>
                </div>
            </div>

            <!-- Página do Dia -->
            <div id="dia-page" class="hidden">
                <div class="chapter-grid" id="chapter-content">
                    <!-- Conteúdo do dia será inserido aqui -->
                </div>
            </div>

            <!-- Editor de Texto -->
            <div id="editor-page" class="hidden">
                <div class="text-editor">
                    <div class="editor-header">
                        <div class="editor-title" id="editor-title">Pregação - Gênesis 1</div>
                        <div class="editor-controls">
                            <button class="control-btn active" onclick="toggleModoVisualizacao()" id="modo-btn">👁️ Visualização</button>
                            <button class="control-btn" onclick="salvarTexto()">💾 Salvar</button>
                            <button class="control-btn" onclick="limparEditor()">🗑️ Limpar</button>
                            <button class="control-btn" onclick="exportarTextoAtual()">📤 Exportar</button>
                        </div>
                    </div>
                    <textarea class="editor-textarea" id="main-editor"
                              placeholder="📝 Cole aqui o conteúdo do Joplin ou digite seu texto...

🎯 Este editor suporta:
• Texto justificado automaticamente
• Copiar e colar do Joplin
• Salvamento automático local
• Modo visualização otimizado

💡 Use este espaço para:
• Pregações detalhadas
• Estudos bíblicos profundos
• Reflexões pessoais
• Orações e meditações
• Anotações e insights

✨ Seu texto será salvo automaticamente no navegador!"></textarea>
                    <div class="editor-footer">
                        <div class="word-stats">
                            <span id="char-count">0 caracteres</span>
                            <span id="word-count">0 palavras</span>
                            <span id="line-count">0 linhas</span>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <span id="last-saved" style="color: #27ae60;">Pronto para editar</span>
                            <button class="control-btn" onclick="voltarParaDia()" style="background: #e74c3c;">← Voltar ao Dia</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="login-modal hidden">
        <div class="login-form">
            <h2 style="margin-bottom: 20px; color: #2c3e50;">🔐 Acesso Administrativo</h2>
            <input type="text" class="login-input" placeholder="Usuário" id="admin-user">
            <input type="password" class="login-input" placeholder="Senha" id="admin-pass">
            <button class="login-btn" onclick="verificarLogin()">Entrar</button>
            <p style="margin-top: 15px; color: #7f8c8d; font-size: 14px;">
                Use: admin / bible2024
            </p>
        </div>
    </div>

    <script>
        // === DADOS GLOBAIS ===
        const planoLeitura = {};
        const textosUsuario = JSON.parse(localStorage.getItem('textosUsuario') || '{}');
        const menusCustomizados = JSON.parse(localStorage.getItem('menusCustomizados') || '{}');
        let contextoAtual = { dia: null, capitulo: null, tipo: null };
        let isAdmin = false;
        let modoVisualizacao = false;

        // Credenciais de admin
        const ADMIN_USER = 'admin';
        const ADMIN_PASS = 'bible2024';

        // Tipos de estudo padrão
        const tiposEstudoPadrao = [
            { nome: 'Pregação', classe: 'pregacao', icone: '🎤' },
            { nome: 'Estudo', classe: 'estudo', icone: '📚' },
            { nome: 'Pontos Complexos e Controversos', classe: 'controversos', icone: '⚖️' },
            { nome: 'Oração', classe: 'oracao', icone: '🙏' },
            { nome: 'Prayer', classe: 'prayer', icone: '🤲' }
        ];

        // Lista completa dos livros da Bíblia
        const livrosBiblia = [
            { nome: 'Gênesis', caps: 50, titulos: [
                'A Criação do Mundo', 'O Jardim do Éden', 'A Queda do Homem', 'Caim e Abel', 'Os Descendentes de Adão',
                'A Maldade Humana', 'O Dilúvio Universal', 'Noé Sai da Arca', 'A Nova Aliança', 'Os Descendentes de Noé',
                'A Torre de Babel', 'Os Descendentes de Sem', 'O Chamado de Abraão', 'Abraão e Ló', 'A Promessa Divina',
                'A Aliança com Abraão', 'Ismael e Isaac', 'A Destruição de Sodoma', 'Abraão e Abimeleque', 'O Nascimento de Isaac',
                'O Sacrifício de Isaac', 'A Morte de Sara', 'Uma Esposa para Isaac', 'A Morte de Abraão', 'Os Descendentes de Ismael',
                'Isaac e Rebeca', 'Jacó e Esaú', 'Isaac e Abimeleque', 'Jacó Engana Isaac', 'A Escada de Jacó',
                'Jacó, Lia e Raquel', 'Os Filhos de Jacó', 'A Fuga de Jacó', 'O Encontro de Jacó e Esaú', 'A Desonra de Diná',
                'Jacó em Betel', 'Os Descendentes de Esaú', 'José e Seus Sonhos', 'José é Vendido', 'Judá e Tamar',
                'José e a Esposa de Potifar', 'José na Prisão', 'Os Sonhos do Faraó', 'José Governador do Egito', 'Os Irmãos de José no Egito',
                'A Segunda Viagem ao Egito', 'A Copa de José', 'José se Revela', 'Jacó vai para o Egito', 'A Bênção de Jacó', 'A Morte de Jacó'
            ]},
            { nome: 'Êxodo', caps: 40 },
            { nome: 'Levítico', caps: 27 },
            { nome: 'Números', caps: 36 },
            { nome: 'Deuteronômio', caps: 34 },
            { nome: 'Josué', caps: 24 },
            { nome: 'Juízes', caps: 21 },
            { nome: 'Rute', caps: 4 },
            { nome: '1 Samuel', caps: 31 },
            { nome: '2 Samuel', caps: 24 },
            { nome: '1 Reis', caps: 22 },
            { nome: '2 Reis', caps: 25 },
            { nome: '1 Crônicas', caps: 29 },
            { nome: '2 Crônicas', caps: 36 },
            { nome: 'Esdras', caps: 10 },
            { nome: 'Neemias', caps: 13 },
            { nome: 'Ester', caps: 10 },
            { nome: 'Jó', caps: 42 },
            { nome: 'Salmos', caps: 150 },
            { nome: 'Provérbios', caps: 31 },
            { nome: 'Eclesiastes', caps: 12 },
            { nome: 'Cantares', caps: 8 },
            { nome: 'Isaías', caps: 66 },
            { nome: 'Jeremias', caps: 52 },
            { nome: 'Lamentações', caps: 5 },
            { nome: 'Ezequiel', caps: 48 },
            { nome: 'Daniel', caps: 12 },
            { nome: 'Oséias', caps: 14 },
            { nome: 'Joel', caps: 3 },
            { nome: 'Amós', caps: 9 },
            { nome: 'Obadias', caps: 1 },
            { nome: 'Jonas', caps: 4 },
            { nome: 'Miquéias', caps: 7 },
            { nome: 'Naum', caps: 3 },
            { nome: 'Habacuque', caps: 3 },
            { nome: 'Sofonias', caps: 3 },
            { nome: 'Ageu', caps: 2 },
            { nome: 'Zacarias', caps: 14 },
            { nome: 'Malaquias', caps: 4 },
            { nome: 'Mateus', caps: 28 },
            { nome: 'Marcos', caps: 16 },
            { nome: 'Lucas', caps: 24 },
            { nome: 'João', caps: 21 },
            { nome: 'Atos', caps: 28 },
            { nome: 'Romanos', caps: 16 },
            { nome: '1 Coríntios', caps: 16 },
            { nome: '2 Coríntios', caps: 13 },
            { nome: 'Gálatas', caps: 6 },
            { nome: 'Efésios', caps: 6 },
            { nome: 'Filipenses', caps: 4 },
            { nome: 'Colossenses', caps: 4 },
            { nome: '1 Tessalonicenses', caps: 5 },
            { nome: '2 Tessalonicenses', caps: 3 },
            { nome: '1 Timóteo', caps: 6 },
            { nome: '2 Timóteo', caps: 4 },
            { nome: 'Tito', caps: 3 },
            { nome: 'Filemom', caps: 1 },
            { nome: 'Hebreus', caps: 13 },
            { nome: 'Tiago', caps: 5 },
            { nome: '1 Pedro', caps: 5 },
            { nome: '2 Pedro', caps: 3 },
            { nome: '1 João', caps: 5 },
            { nome: '2 João', caps: 1 },
            { nome: '3 João', caps: 1 },
            { nome: 'Judas', caps: 1 },
            { nome: 'Apocalipse', caps: 22 }
        ];

        // === FUNÇÕES DE INICIALIZAÇÃO ===
        function inicializar() {
            gerarPlanoLeitura();
            renderizarCalendario();
            configurarEditor();
            verificarSessaoAdmin();
        }

        function gerarPlanoLeitura() {
            let dia = 1;
            let livroIndex = 0;
            let capituloAtual = 1;

            while (dia <= 365 && livroIndex < livrosBiblia.length) {
                const livro = livrosBiblia[livroIndex];
                const capitulosPorDia = Math.max(1, Math.ceil(livro.caps / 10));

                for (let c = capituloAtual; c <= livro.caps && dia <= 365; c += capitulosPorDia) {
                    const capitulos = [];
                    const fimCapitulo = Math.min(c + capitulosPorDia - 1, livro.caps);

                    for (let i = c; i <= fimCapitulo; i++) {
                        const titulo = livro.titulos && livro.titulos[i-1]
                            ? livro.titulos[i-1]
                            : `Capítulo ${i}`;

                        capitulos.push({
                            numero: i,
                            titulo: titulo,
                            livro: livro.nome
                        });
                    }

                    planoLeitura[dia] = {
                        data: obterDataDoDia(dia),
                        capitulos: capitulos
                    };

                    dia++;
                }

                livroIndex++;
                capituloAtual = 1;
            }
        }

        function obterDataDoDia(dia) {
            const inicioAno = new Date(2024, 0, 1);
            const dataAtual = new Date(inicioAno);
            dataAtual.setDate(inicioAno.getDate() + dia - 1);

            return dataAtual.toLocaleDateString('pt-BR', {
                day: 'numeric',
                month: 'short'
            });
        }

        function obterMesDoDia(dia) {
            const inicioAno = new Date(2024, 0, 1);
            const dataAtual = new Date(inicioAno);
            dataAtual.setDate(inicioAno.getDate() + dia - 1);

            const meses = ['jan', 'fev', 'mar', 'abr', 'mai', 'jun',
                          'jul', 'ago', 'set', 'out', 'nov', 'dez'];
            return meses[dataAtual.getMonth()];
        }

        // === FUNÇÕES DE NAVEGAÇÃO ===
        function renderizarCalendario() {
            const grid = document.getElementById('day-grid');
            grid.innerHTML = '';

            for (let dia = 1; dia <= 365; dia++) {
                const dadosDia = planoLeitura[dia];
                if (!dadosDia) continue;

                const card = document.createElement('div');
                card.className = 'day-card';
                card.setAttribute('data-mes', obterMesDoDia(dia));
                card.onclick = () => abrirDia(dia);

                const titulosCapitulos = dadosDia.capitulos
                    .map(cap => `${cap.livro} ${cap.numero}`)
                    .join(', ');

                card.innerHTML = `
                    <div style="font-size: 1.2em; font-weight: bold; margin-bottom: 8px;">
                        Dia ${dia}
                    </div>
                    <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 10px;">
                        ${dadosDia.data}
                    </div>
                    <div style="font-size: 0.8em; line-height: 1.3;">
                        ${titulosCapitulos}
                    </div>
                `;

                grid.appendChild(card);
            }
        }

        function filtrarPorMes(mes) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            const cards = document.querySelectorAll('.day-card');

            if (mes === 'todos') {
                cards.forEach(card => card.style.display = 'block');
            } else {
                cards.forEach(card => {
                    if (card.getAttribute('data-mes') === mes) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            }
        }

        function abrirDia(dia) {
            contextoAtual.dia = dia;

            document.getElementById('indice-page').classList.add('hidden');
            document.getElementById('dia-page').classList.remove('hidden');
            document.querySelector('.back-button').style.display = 'block';

            const dadosDia = planoLeitura[dia];
            document.getElementById('page-title').textContent =
                `📅 Dia ${dia} - ${dadosDia.data}`;

            renderizarCapitulos(dia);
        }

        function renderizarCapitulos(dia) {
            const dadosDia = planoLeitura[dia];
            const container = document.getElementById('chapter-content');
            container.innerHTML = '';

            dadosDia.capitulos.forEach((capitulo, index) => {
                const section = document.createElement('div');
                section.className = 'chapter-section';

                const chaveCapitulo = `${capitulo.livro}_${capitulo.numero}`;
                const menuPersonalizado = menusCustomizados[`${dia}_${chaveCapitulo}`] || [];
                const tiposParaExibir = [...tiposEstudoPadrao, ...menuPersonalizado];

                section.innerHTML = `
                    <div class="chapter-title">
                        ${capitulo.livro} ${capitulo.numero}: ${capitulo.titulo}
                        ${isAdmin ? `<button class="edit-menu-btn" onclick="editarMenu(${dia}, '${chaveCapitulo}')">✏️ Editar Menu</button>` : ''}
                    </div>
                    <div class="study-types">
                        ${tiposParaExibir.map(tipo => `
                            <button class="study-button ${tipo.classe}" onclick="abrirEditor(${dia}, '${chaveCapitulo}', '${tipo.nome}')">
                                ${tipo.icone} ${tipo.nome}
                            </button>
                        `).join('')}
                    </div>
                `;

                container.appendChild(section);
            });
        }

        // === FUNÇÕES DO EDITOR ===
        function abrirEditor(dia, capitulo, tipo) {
            contextoAtual = { dia, capitulo, tipo };

            document.getElementById('dia-page').classList.add('hidden');
            document.getElementById('editor-page').classList.remove('hidden');

            const tituloEditor = `${tipo} - ${capitulo.replace('_', ' ')}`;
            document.getElementById('editor-title').textContent = tituloEditor;
            document.getElementById('page-title').textContent = `✍️ ${tituloEditor}`;

            carregarTexto();
        }

        function carregarTexto() {
            const chave = `${contextoAtual.dia}_${contextoAtual.capitulo}_${contextoAtual.tipo}`;
            const textoSalvo = textosUsuario[chave] || '';

            const editor = document.getElementById('main-editor');
            editor.value = textoSalvo;
            atualizarEstatisticas();

            if (textoSalvo) {
                document.getElementById('last-saved').textContent = 'Texto carregado';
                document.getElementById('last-saved').style.color = '#27ae60';
            }
        }

        function salvarTexto() {
            const chave = `${contextoAtual.dia}_${contextoAtual.capitulo}_${contextoAtual.tipo}`;
            const texto = document.getElementById('main-editor').value;

            textosUsuario[chave] = texto;
            localStorage.setItem('textosUsuario', JSON.stringify(textosUsuario));

            const agora = new Date().toLocaleTimeString('pt-BR', {
                hour: '2-digit',
                minute: '2-digit'
            });

            document.getElementById('last-saved').textContent = `Salvo às ${agora}`;
            document.getElementById('last-saved').style.color = '#27ae60';

            // Feedback visual
            const btnSalvar = event.target;
            const textoOriginal = btnSalvar.textContent;
            btnSalvar.textContent = '✅ Salvo!';
            btnSalvar.style.background = '#27ae60';

            setTimeout(() => {
                btnSalvar.textContent = textoOriginal;
                btnSalvar.style.background = '';
            }, 2000);
        }

        function limparEditor() {
            if (confirm('Tem certeza que deseja limpar todo o texto? Esta ação não pode ser desfeita.')) {
                document.getElementById('main-editor').value = '';
                atualizarEstatisticas();
                document.getElementById('last-saved').textContent = 'Texto limpo';
                document.getElementById('last-saved').style.color = '#e74c3c';
            }
        }

        function configurarEditor() {
            const editor = document.getElementById('main-editor');

            // Auto-save ao digitar
            let timeoutSave;
            editor.addEventListener('input', () => {
                atualizarEstatisticas();

                clearTimeout(timeoutSave);
                timeoutSave = setTimeout(() => {
                    salvarTexto();
                }, 3000);
            });

            // Teclas de atalho
            editor.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    salvarTexto();
                }
                if (e.ctrlKey && e.key === 'l') {
                    e.preventDefault();
                    limparEditor();
                }
            });
        }

        function atualizarEstatisticas() {
            const texto = document.getElementById('main-editor').value;
            const caracteres = texto.length;
            const palavras = texto.trim() ? texto.trim().split(/\s+/).length : 0;
            const linhas = texto.split('\n').length;

            document.getElementById('char-count').textContent = `${caracteres} caracteres`;
            document.getElementById('word-count').textContent = `${palavras} palavras`;
            document.getElementById('line-count').textContent = `${linhas} linhas`;
        }

        function toggleModoVisualizacao() {
            const editor = document.getElementById('main-editor');
            const btn = document.getElementById('modo-btn');

            modoVisualizacao = !modoVisualizacao;

            if (modoVisualizacao) {
                editor.className = 'reading-mode';
                btn.textContent = '✏️ Editar';
                btn.classList.remove('active');
                editor.style.fontSize = '18px';
                editor.style.lineHeight = '1.8';
            } else {
                editor.className = 'editor-textarea';
                btn.textContent = '👁️ Visualização';
                btn.classList.add('active');
                editor.style.fontSize = '16px';
                editor.style.lineHeight = '1.6';
            }
        }

        function voltarParaDia() {
            document.getElementById('editor-page').classList.add('hidden');
            document.getElementById('dia-page').classList.remove('hidden');

            const dadosDia = planoLeitura[contextoAtual.dia];
            document.getElementById('page-title').textContent =
                `📅 Dia ${contextoAtual.dia} - ${dadosDia.data}`;
        }

        function voltarIndice() {
            document.getElementById('dia-page').classList.add('hidden');
            document.getElementById('editor-page').classList.add('hidden');
            document.getElementById('indice-page').classList.remove('hidden');
            document.querySelector('.back-button').style.display = 'none';
            document.getElementById('page-title').textContent = '📖 Plano Anual de Leitura Bíblica';
        }

        // === FUNÇÕES DE LOGIN E ADMIN ===
        function mostrarLogin() {
            document.getElementById('login-modal').classList.remove('hidden');
            document.getElementById('admin-user').focus();
        }

        function verificarLogin() {
            const user = document.getElementById('admin-user').value;
            const pass = document.getElementById('admin-pass').value;

            if (user === ADMIN_USER && pass === ADMIN_PASS) {
                isAdmin = true;
                localStorage.setItem('adminSession', 'true');

                // Fechar modal imediatamente
                const modal = document.getElementById('login-modal');
                modal.classList.add('hidden');
                modal.style.display = 'none';

                // Atualizar botões de admin
                document.getElementById('admin-login-btn').classList.add('hidden');
                document.getElementById('admin-logout-btn').classList.remove('hidden');

                // Limpar campos
                document.getElementById('admin-user').value = '';
                document.getElementById('admin-pass').value = '';

                // Re-renderizar se estiver na página de um dia
                if (contextoAtual.dia) {
                    renderizarCapitulos(contextoAtual.dia);
                }

                console.log('Login administrativo realizado com sucesso');
            } else {
                alert('Credenciais inválidas');
            }
        }

        function logout() {
            isAdmin = false;
            localStorage.removeItem('adminSession');

            document.getElementById('admin-login-btn').classList.remove('hidden');
            document.getElementById('admin-logout-btn').classList.add('hidden');

            // Re-renderizar se estiver na página de um dia
            if (contextoAtual.dia) {
                renderizarCapitulos(contextoAtual.dia);
            }
        }

        function verificarSessaoAdmin() {
            if (localStorage.getItem('adminSession') === 'true') {
                isAdmin = true;
                document.getElementById('admin-login-btn').classList.add('hidden');
                document.getElementById('admin-logout-btn').classList.remove('hidden');
            }
        }

        // Fechar modal ao clicar fora
        document.getElementById('login-modal').addEventListener('click', (e) => {
            if (e.target.id === 'login-modal') {
                document.getElementById('login-modal').classList.add('hidden');
            }
        });

        // Enter no login
        document.getElementById('admin-pass').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                verificarLogin();
            }
        });

        // === FUNÇÕES DE CUSTOMIZAÇÃO (ADMIN) ===
        function editarMenu(dia, chaveCapitulo) {
            const menuAtual = menusCustomizados[`${dia}_${chaveCapitulo}`] || [];

            let menuTexto = menuAtual.map(item =>
                `${item.nome}|${item.classe}|${item.icone}`
            ).join('\n');

            const novoMenu = prompt(`📝 Editar Menu Personalizado

Formato: Nome|classe-css|emoji
Exemplo: Sermão Especial|custom|⭐

Menu atual:
${menuTexto}

Cole o novo menu (um por linha):`, menuTexto);

            if (novoMenu !== null) {
                const novosItens = [];

                novoMenu.split('\n').forEach(linha => {
                    linha = linha.trim();
                    if (linha) {
                        const partes = linha.split('|');
                        if (partes.length >= 2) {
                            novosItens.push({
                                nome: partes[0],
                                classe: partes[1] || 'custom',
                                icone: partes[2] || '📝'
                            });
                        }
                    }
                });

                if (novosItens.length > 0) {
                    menusCustomizados[`${dia}_${chaveCapitulo}`] = novosItens;
                } else {
                    delete menusCustomizados[`${dia}_${chaveCapitulo}`];
                }

                localStorage.setItem('menusCustomizados', JSON.stringify(menusCustomizados));
                renderizarCapitulos(dia);

                alert('✅ Menu personalizado atualizado!');
            }
        }

        function exportarTextoAtual() {
            const texto = document.getElementById('main-editor').value;

            if (!texto.trim()) {
                alert('⚠️ Não há texto para exportar!');
                return;
            }

            const nomeArquivo = `${contextoAtual.tipo}_${contextoAtual.capitulo}_Dia${contextoAtual.dia}.txt`;
            const blob = new Blob([texto], { type: 'text/plain;charset=utf-8' });

            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = nomeArquivo;
            link.click();

            URL.revokeObjectURL(link.href);
        }

        // === FUNÇÕES DE EXPORTAÇÃO ===
        function exportarParaExcel() {
            let csvContent = "Dia,Data,Livro,Capítulo,Título\n";

            for (let dia = 1; dia <= 365; dia++) {
                const dadosDia = planoLeitura[dia];
                if (dadosDia) {
                    dadosDia.capitulos.forEach(cap => {
                        csvContent += `${dia},"${dadosDia.data}","${cap.livro}",${cap.numero},"${cap.titulo}"\n`;
                    });
                }
            }

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'Plano_Leitura_Biblica_2024.csv';
            link.click();

            URL.revokeObjectURL(link.href);
        }

        function exportarMarkdown() {
            let markdown = `# 📖 Plano Anual de Leitura Bíblica 2024\n\n`;
            markdown += `**365 Dias | Gênesis ao Apocalipse | Almeida Atualizada**\n\n`;
            markdown += `---\n\n`;

            let mesAtual = '';

            for (let dia = 1; dia <= 365; dia++) {
                const dadosDia = planoLeitura[dia];
                if (!dadosDia) continue;

                // Detectar mudança de mês
                const inicioAno = new Date(2024, 0, 1);
                const dataAtual = new Date(inicioAno);
                dataAtual.setDate(inicioAno.getDate() + dia - 1);
                const nomesMeses = [
                    'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
                    'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
                ];
                const mesNome = nomesMeses[dataAtual.getMonth()];

                if (mesNome !== mesAtual) {
                    mesAtual = mesNome;
                    markdown += `## 📅 ${mesAtual}\n\n`;
                }

                markdown += `### Dia ${dia} - ${dadosDia.data}\n\n`;

                dadosDia.capitulos.forEach(cap => {
                    markdown += `- **${cap.livro} ${cap.numero}:** ${cap.titulo}\n`;
                });

                markdown += `\n`;
            }

            markdown += `---\n\n`;
            markdown += `*Gerado automaticamente pelo Sistema de Leitura Bíblica*\n`;
            markdown += `*Total: 1.189 capítulos | 31.102 versículos | 66 livros*`;

            const blob = new Blob([markdown], { type: 'text/markdown;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'Plano_Leitura_Biblica_2024.md';
            link.click();

            URL.revokeObjectURL(link.href);
        }

        function exportarTodosTextos() {
            if (!isAdmin) {
                alert('⚠️ Função disponível apenas para administradores!');
                return;
            }

            if (Object.keys(textosUsuario).length === 0) {
                alert('⚠️ Não há textos salvos para exportar!');
                return;
            }

            let conteudoCompleto = `# 📖 BACKUP COMPLETO - PLANO DE LEITURA BÍBLICA\n\n`;
            conteudoCompleto += `**Exportado em:** ${new Date().toLocaleString('pt-BR')}\n\n`;
            conteudoCompleto += `**Total de textos:** ${Object.keys(textosUsuario).length}\n\n`;
            conteudoCompleto += `---\n\n`;

            Object.keys(textosUsuario).sort().forEach(chave => {
                const partes = chave.split('_');
                const dia = partes[0];
                const capitulo = partes.slice(1, -1).join(' ');
                const tipo = partes[partes.length - 1];

                conteudoCompleto += `## 📅 Dia ${dia} | ${capitulo} | ${tipo}\n\n`;
                conteudoCompleto += `${textosUsuario[chave]}\n\n`;
                conteudoCompleto += `---\n\n`;
            });

            const blob = new Blob([conteudoCompleto], { type: 'text/markdown;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Backup_Completo_${new Date().toISOString().split('T')[0]}.md`;
            link.click();

            URL.revokeObjectURL(link.href);

            alert(`✅ Backup exportado com ${Object.keys(textosUsuario).length} textos!`);
        }

        // === FUNÇÃO DE BUSCA (BONUS) ===
        function buscarTextos(termo) {
            if (!termo || termo.length < 3) {
                alert('⚠️ Digite pelo menos 3 caracteres para buscar');
                return [];
            }

            const resultados = [];
            const termoLower = termo.toLowerCase();

            Object.keys(textosUsuario).forEach(chave => {
                const texto = textosUsuario[chave].toLowerCase();
                if (texto.includes(termoLower)) {
                    const partes = chave.split('_');
                    resultados.push({
                        dia: partes[0],
                        capitulo: partes.slice(1, -1).join(' '),
                        tipo: partes[partes.length - 1],
                        texto: textosUsuario[chave],
                        chave: chave
                    });
                }
            });

            return resultados;
        }

        // Adicionar botão de busca no modo admin
        function adicionarBusca() {
            if (isAdmin && !document.getElementById('busca-admin')) {
                const controles = document.querySelector('.admin-controls');
                const btnBusca = document.createElement('button');
                btnBusca.className = 'admin-btn';
                btnBusca.id = 'busca-admin';
                btnBusca.innerHTML = '🔍 Buscar';
                btnBusca.onclick = () => {
                    const termo = prompt('🔍 Buscar nos textos salvos:');
                    if (termo) {
                        const resultados = buscarTextos(termo);
                        if (resultados.length > 0) {
                            alert(`✅ Encontrados ${resultados.length} resultado(s) para "${termo}"`);
                            console.log('Resultados da busca:', resultados);
                        } else {
                            alert(`❌ Nenhum resultado encontrado para "${termo}"`);
                        }
                    }
                };
                controles.appendChild(btnBusca);
            }
        }

        // === FUNÇÕES DE UTILIDADE ===
        function obterEstatisticasGerais() {
            const stats = {
                totalTextos: Object.keys(textosUsuario).length,
                totalPalavras: 0,
                totalCaracteres: 0,
                tiposMaisUsados: {},
                diasComTexto: new Set(),
                ultimaAtualizacao: null
            };

            Object.keys(textosUsuario).forEach(chave => {
                const texto = textosUsuario[chave];
                const partes = chave.split('_');
                const dia = partes[0];
                const tipo = partes[partes.length - 1];

                stats.totalCaracteres += texto.length;
                stats.totalPalavras += texto.trim() ? texto.trim().split(/\s+/).length : 0;
                stats.diasComTexto.add(dia);

                stats.tiposMaisUsados[tipo] = (stats.tiposMaisUsados[tipo] || 0) + 1;
            });

            stats.diasComTexto = stats.diasComTexto.size;

            return stats;
        }

        function mostrarEstatisticas() {
            if (!isAdmin) return;

            const stats = obterEstatisticasGerais();
            const tipoMaisUsado = Object.keys(stats.tiposMaisUsados)
                .reduce((a, b) => stats.tiposMaisUsados[a] > stats.tiposMaisUsados[b] ? a : b, '');

            alert(`📊 ESTATÍSTICAS DO SISTEMA

📝 Total de textos: ${stats.totalTextos}
📖 Dias com conteúdo: ${stats.diasComTexto}/365 (${Math.round(stats.diasComTexto/365*100)}%)
📄 Total de palavras: ${stats.totalPalavras.toLocaleString('pt-BR')}
🔤 Total de caracteres: ${stats.totalCaracteres.toLocaleString('pt-BR')}
⭐ Tipo mais usado: ${tipoMaisUsado} (${stats.tiposMaisUsados[tipoMaisUsado] || 0}x)

💾 Dados salvos localmente no navegador`);
        }

        // === ATALHOS DE TECLADO GLOBAIS ===
        document.addEventListener('keydown', (e) => {
            // Esc para voltar
            if (e.key === 'Escape') {
                if (!document.getElementById('indice-page').classList.contains('hidden')) return;

                if (!document.getElementById('editor-page').classList.contains('hidden')) {
                    voltarParaDia();
                } else if (!document.getElementById('dia-page').classList.contains('hidden')) {
                    voltarIndice();
                }
            }

            // Ctrl+H para home
            if (e.ctrlKey && e.key === 'h') {
                e.preventDefault();
                voltarIndice();
            }

            // F1 para estatísticas (admin)
            if (e.key === 'F1' && isAdmin) {
                e.preventDefault();
                mostrarEstatisticas();
            }
        });

        // === TRATAMENTO DE ERROS ===
        window.addEventListener('error', (e) => {
            console.error('Erro capturado:', e.error);

            // Salvar dados em caso de erro crítico
            if (contextoAtual.dia && document.getElementById('main-editor')) {
                try {
                    salvarTexto();
                } catch (err) {
                    console.error('Erro ao salvar texto de emergência:', err);
                }
            }
        });

        // === MELHORIAS DE UX ===
        function adicionarMelhorias() {
            // Animações de entrada
            document.querySelectorAll('.day-card').forEach((card, index) => {
                card.style.animationDelay = `${index * 0.02}s`;
                card.classList.add('fade-in');
            });

            // Tooltips nos botões admin
            if (isAdmin) {
                adicionarBusca();

                const btnExportBackup = document.createElement('button');
                btnExportBackup.className = 'admin-btn';
                btnExportBackup.innerHTML = '💾 Backup';
                btnExportBackup.onclick = exportarTodosTextos;
                btnExportBackup.title = 'Exportar todos os textos salvos';

                const btnStats = document.createElement('button');
                btnStats.className = 'admin-btn';
                btnStats.innerHTML = '📊 Stats';
                btnStats.onclick = mostrarEstatisticas;
                btnStats.title = 'Ver estatísticas do sistema';

                const controles = document.querySelector('.admin-controls');
                controles.appendChild(btnExportBackup);
                controles.appendChild(btnStats);
            }

            // Mensagem de boas-vindas
            setTimeout(() => {
                if (Object.keys(textosUsuario).length === 0) {
                    const bemVindo = `📖 Bem-vindo ao Plano Anual de Leitura Bíblica!

🎯 Como usar:
• Clique em um dia para ver os capítulos
• Escolha o tipo de estudo (Pregação, Estudo, etc.)
• Digite ou cole seu conteúdo no editor
• Seus textos são salvos automaticamente

✨ Recursos especiais:
• Modo visualização otimizada
• Exportação individual ou completa
• Busca em todos os textos (admin)
• Menus personalizáveis (admin)

🔐 Acesso admin: admin / bible2024`;

                    if (confirm(bemVindo + '\n\nDeseja fazer login como administrador agora?')) {
                        mostrarLogin();
                    }
                }
            }, 1000);
        }

        // === INICIALIZAÇÃO FINAL ===
        document.addEventListener('DOMContentLoaded', () => {
            try {
                inicializar();
                adicionarMelhorias();

                console.log('📖 Sistema de Leitura Bíblica carregado com sucesso!');
                console.log(`📊 ${Object.keys(textosUsuario).length} textos salvos encontrados`);

            } catch (error) {
                console.error('❌ Erro na inicialização:', error);
                alert('⚠️ Houve um erro ao carregar o sistema. Recarregue a página.');
            }
        });

        // === INFORMAÇÕES DE DEBUG (SOMENTE CONSOLE) ===
        console.log(`
🎯 SISTEMA DE LEITURA BÍBLICA - DEBUG INFO
===========================================
📅 Plano: 365 dias de leitura
📖 Livros: 66 (Gênesis ao Apocalipse)
📝 Capítulos: 1.189 total
🔐 Admin: ${isAdmin ? 'Ativo' : 'Inativo'}
💾 Textos salvos: ${Object.keys(textosUsuario).length}
🎨 Menus customizados: ${Object.keys(menusCustomizados).length}

⌨️ ATALHOS:
- Esc: Voltar
- Ctrl+S: Salvar (no editor)
- Ctrl+L: Limpar editor
- Ctrl+H: Voltar ao início
- F1: Estatísticas (admin)

🚀 Sistema pronto para uso!
        `);

    </script>
</body>
</html>